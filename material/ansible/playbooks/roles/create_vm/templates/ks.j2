# Generated by Anaconda 34.25.2.10
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
text

# Network information
network --bootproto=static --device={{ virt_install_param.interface }} --ip={{ virt_install_param.ip_addr }} --netmask={{ virt_install_param.netmask }} --gateway={{ virt_install_param.gateway }} --nameserver={{ internal_name_server }} --noipv6 --activate --hostname={{ virt_install_param.hostname }} --onboot=on
repo --name="{{ repo_on_ksfile.name }}" --baseurl={{ repo_on_ksfile.baseurl }}

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --vckeymap=jp --xlayouts='jp'
# System language
lang en_US.UTF-8

# Use CDROM installation media
cdrom

# System services
services --enabled="sshd,NetworkManager" --disabled=firewalld 

# Firewall configuration
firewall --disabled 

# SELinux configuration
selinux --disabled

%packages
@^minimal-environment
{% for packages in virt_install_installed_packages %}
{{ packages }}
{% endfor %}

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=vda
autopart --type=plain --fstype=ext4
zerombr

# Partition clearing information
clearpart --all --initlabel

# System timezone
timezone Asia/Tokyo --utc

# System bootloader configuration
bootloader --location=mbr

# Root password
rootpw --iscrypted {{ ks_root_pw }}

# Create ansible user
user --name=ansible --groups=wheel --iscrypted --password={{ ks_ansible_pw }}

# Reboot after installation
reboot

%pre

%end

%post
# network
cat << 'EOF' > /etc/sysconfig/network
NETWORKING=yes
NETWORKING_IPV6=no
EOF

cat << 'EOF' > /etc/resolv.conf
nameserver {{ internal_name_server }}
EOF

dnf -y upgrade

%end

